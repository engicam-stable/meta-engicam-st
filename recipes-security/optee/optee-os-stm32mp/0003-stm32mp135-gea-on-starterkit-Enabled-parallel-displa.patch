From a33e0d2e7bfd453ddc2639c3b39dc5505364bb36 Mon Sep 17 00:00:00 2001
From: Franesco Utel <francesco.utel@engicam.com>
Date: Fri, 29 Jul 2022 16:53:54 +0200
Subject: [PATCH] stm32mp135 gea on starterkit - Enabled parallel display and
 touchscreen

---
 .../arm/dts/stm32mp135d-gea-starterkit-mx.dts | 21 ++++++++++++++++++-
 1 file changed, 20 insertions(+), 1 deletion(-)

diff --git a/core/arch/arm/dts/stm32mp135d-gea-starterkit-mx.dts b/core/arch/arm/dts/stm32mp135d-gea-starterkit-mx.dts
index 570e947c5..990235865 100644
--- a/core/arch/arm/dts/stm32mp135d-gea-starterkit-mx.dts
+++ b/core/arch/arm/dts/stm32mp135d-gea-starterkit-mx.dts
@@ -152,6 +152,7 @@
 	/*"Non Secured" peripherals*/
 	DECPROT(STM32MP1_ETZPC_ETH1_ID, DECPROT_NS_RW, DECPROT_UNLOCK)
 	DECPROT(STM32MP1_ETZPC_ETH2_ID, DECPROT_NS_RW, DECPROT_UNLOCK)
+	DECPROT(STM32MP1_ETZPC_LTDC_ID, DECPROT_NS_RW, DECPROT_UNLOCK)
 	DECPROT(STM32MP1_ETZPC_SDMMC1_ID, DECPROT_NS_RW, DECPROT_UNLOCK)
 	DECPROT(STM32MP1_ETZPC_SDMMC2_ID, DECPROT_NS_RW, DECPROT_UNLOCK)
 	DECPROT(STM32MP1_ETZPC_USART2_ID, DECPROT_NS_RW, DECPROT_UNLOCK)
@@ -381,6 +382,7 @@
 		CLK_STGEN_HSI
 		CLK_USBPHY_HSE
 		CLK_USBO_USBPHY
+		CLK_I2C12_PCLK1
 		CLK_I2C5_PCLK6
 		CLK_UART2_PCLK6
 		CLK_UART4_PCLK1
@@ -415,6 +417,10 @@
 			src = < CLK_PLL3_HSE >;
 			divmn = < 1 49 >;
 		};
+		pll4_vco_600Mhz_mx: pll4-vco-600Mhz-mx {
+			src = < CLK_PLL4_HSE >;
+			divmn = < 1 49 >;
+		};
 
 		/* USER CODE BEGIN rcc_st-pll_vco */
 		/* USER CODE END rcc_st-pll_vco */
@@ -462,6 +468,20 @@
 		/* USER CODE END pll3 */
 	};
 
+	pll4:st,pll@3 {
+		compatible = "st,stm32mp1-pll";
+		reg = <3>;
+
+		st,pll = < &pll4_cfg1 >;
+
+		pll4_cfg1: pll4_cfg1 {
+			st,pll_vco = < &pll4_vco_600Mhz_mx >;
+			st,pll_div_pqr = < 0 59 5 >;
+		};
+		/* USER CODE BEGIN pll4 */
+		/* USER CODE END pll4 */
+	};
+
 	st,clk_opp {
 		/* CK_MPU clock config for MP13 */
 		st,ck_mpu {
@@ -587,4 +607,3 @@
 	};
 };
 /* USER CODE END addons */
-
